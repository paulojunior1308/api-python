<script>
    const searchForm = document.getElementById('searchForm');
    const cityInput = document.getElementById('cityInput');
    const searchButton = document.getElementById('searchButton');
    const errorDiv = document.getElementById('error');
    const resultsDiv = document.getElementById('results');
    const emptyMessage = document.getElementById('emptyMessage');

    const API_URL = "https://api-python-yr6q.onrender.com/api/establishments"; // üîπ Alterado para Render

    searchForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const cidade = cityInput.value.trim();
        if (!cidade) return;

        searchButton.disabled = true;
        errorDiv.style.display = 'none';
        resultsDiv.innerHTML = '';
        emptyMessage.style.display = 'none';

        try {
            const response = await fetch(`${API_URL}?city=${encodeURIComponent(cidade)}`);
            if (!response.ok) throw new Error('Falha ao buscar estabelecimentos');
            
            const estabelecimentos = await response.json();
            
            if (estabelecimentos.length === 0) {
                emptyMessage.textContent = 'Nenhum estabelecimento encontrado nesta cidade';
                emptyMessage.style.display = 'block';
                return;
            }

            estabelecimentos.forEach(estabelecimento => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <h2 class="card-title">${estabelecimento.nome}</h2>
                    </div>
                    <div class="card-content">
                        <div>${estabelecimento.endere√ßo}</div>
                        <div>${estabelecimento.telefone}</div>
                        ${estabelecimento.instagram !== "N√£o encontrado" 
                            ? `<div><a href="${estabelecimento.instagram}" target="_blank" rel="noopener noreferrer">Perfil no Instagram</a></div>`
                            : ''
                        }
                    </div>
                `;
                resultsDiv.appendChild(card);
            });
        } catch (err) {
            errorDiv.textContent = 'N√£o foi poss√≠vel carregar os estabelecimentos. Tente novamente.';
            errorDiv.style.display = 'block';
            console.error(err);
        } finally {
            searchButton.disabled = false;
        }
    });
</script>
